<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
</head>
<body>
    <h1>QR Code Scanner</h1>
    <video id="video" width="100%" height="100%" autoplay></video>
    <script src="https://rawgit.com/cozmo/jsQR/master/dist/jsQR.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', (event) => {
            const video = document.getElementById('video');

            navigator.mediaDevices.getUserMedia({ video: true })
                .then((stream) => {
                    video.srcObject = stream;
                    video.play();

                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.width = video.videoWidth;
                    canvas.height = video.videoHeight;

                    video.addEventListener('loadedmetadata', () => {
                        setInterval(() => {
                            context.drawImage(video, 0, 0, canvas.width, canvas.height);
                            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                            const code = jsQR(imageData.data, imageData.width, imageData.height);

                            if (code) {
                                console.log('QR Code detected:', code.data);

                                // Convert the QR code value to base64
                                const base64Value = btoa(code.data);
                                console.log('Base64 Value:', base64Value);

                                // Send the base64 value to the API
                                sendToAPI(base64Value);
                            }
                        }, 1000);
                    });
                })
                .catch((error) => {
                    console.error('Error accessing camera:', error);
                });

            function sendToAPI(base64Value) {
                const apiUrl = 'http://localhost:8080/api/attendance';

                fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        qrBase64String: base64Value,
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    console.log('API Response:', data);
                    // Handle the API response as needed
                })
                .catch(error => {
                    console.error('Error sending data to API:', error);
                });
            }
        });
    </script>
</body>
</html>
